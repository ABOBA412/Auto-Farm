local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local EnemiesFolder = workspace:WaitForChild("Enemies")

local activeBrings = {}
local anchorMob = nil

-- получить RootPart моба
local function getMobRoot(mob)
    return mob:FindFirstChild("HumanoidRootPart")
end

-- получить ближайшего моба к игроку
local function getClosestMob(enemyName)
    local char = LocalPlayer.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    if not root then return nil end

    local closest, dist = nil, math.huge
    for _, mob in ipairs(EnemiesFolder:GetChildren()) do
        if mob.Name == enemyName and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
            local mobRoot = getMobRoot(mob)
            if mobRoot then
                local mag = (mobRoot.Position - root.Position).Magnitude
                if mag < dist then
                    dist = mag
                    closest = mob
                end
            end
        end
    end
    return closest
end

-- притягивание всех мобов к якорю
local function bringMobs(enemyName)
    task.spawn(function()
        while anchorMob and anchorMob.Parent == EnemiesFolder and anchorMob.Humanoid.Health > 0 do
            local anchorRoot = getMobRoot(anchorMob)
            if not anchorRoot then break end

            for _, mob in ipairs(EnemiesFolder:GetChildren()) do
                if mob ~= anchorMob and mob.Name == enemyName and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
                    if not activeBrings[mob] then
                        local mobRoot = getMobRoot(mob)
                        if mobRoot then
                            local att0 = Instance.new("Attachment")
                            att0.Parent = mobRoot

                            local align = Instance.new("AlignPosition")
                            align.Parent = mobRoot
                            align.MaxForce = 9999999
                            align.Responsiveness = 200
                            align.Attachment0 = att0
                            align.Mode = Enum.PositionAlignmentMode.OneAttachment
                            align.ApplyAtCenterOfMass = true

                            activeBrings[mob] = {att = att0, align = align}
                        end
                    end

                    -- обновляем цель
                    local stuff = activeBrings[mob]
                    if stuff and stuff.align then
                        stuff.align.Position = anchorRoot.Position
                    end
                end
            end
            RunService.Heartbeat:Wait()
        end

        -- если якорь умер → очистка
        for mob, stuff in pairs(activeBrings) do
            if stuff.att then stuff.att:Destroy() end
            if stuff.align then stuff.align:Destroy() end
        end
        activeBrings = {}
        anchorMob = nil
    end)
end

-- запуск
function StartBringMobs(enemyName)
    if not anchorMob then
        anchorMob = getClosestMob(enemyName)
        if anchorMob then
            bringMobs(enemyName)
        else
            warn("Нет мобов с именем " .. enemyName)
        end
    end
end

-- остановка
function StopBringMobs()
    anchorMob = nil
    for mob, stuff in pairs(activeBrings) do
        if stuff.att then stuff.att:Destroy() end
        if stuff.align then stuff.align:Destroy() end
    end
    activeBrings = {}
end

StartBringMobs("Bandit")
